@page "{id:int}"
@model EVCharging.Pages.Staff.Booking.DetailModel
@{
    ViewData["Title"] = "Booking detail (Staff)";
    var b = Model.Item!;
}
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" />

<div class="container py-4">
    <a class="btn btn-light border mb-3" asp-page="/Staff/Booking/Index">← Quay lại danh sách</a>

    <div class="card shadow-sm mb-4">
        <div class="card-header bg-white">
            <strong>Booking #@b.BookingId</strong>
            <span class="ms-2 badge text-bg-@(b.Status == "success" ? "success" : b.Status == "cancelled" ? "danger" : "secondary")">
                @b.Status
            </span>
        </div>
        <div class="card-body">
            <div class="row g-3">
                <div class="col-md-4">
                    <div class="text-muted">Bắt đầu</div>
                    <div class="fw-semibold">@((b.StartTime?.ToLocalTime().ToString("dd/MM/yyyy HH:mm")) ?? "-")</div>
                </div>
                <div class="col-md-4">
                    <div class="text-muted">Kết thúc</div>
                    <div class="fw-semibold">@((b.EndTime?.ToLocalTime().ToString("dd/MM/yyyy HH:mm")) ?? "-")</div>
                </div>
                <div class="col-md-4">
                    <div class="text-muted">Giá</div>
                    <div class="fw-semibold">@b.Price.ToString("N0") ₫</div>
                </div>
            </div>
        </div>
    </div>

    <div class="card shadow-sm">
        <div class="card-header bg-white"><strong>Charging Sessions</strong></div>
        <div class="card-body">
            @if (b.Sessions.Count == 0)
            {
                <div class="text-muted">Chưa có session nào.</div>
            }
            else
            {
                <div class="table-responsive">
                    <table class="table align-middle">
                        <thead class="table-light">
                            <tr>
                                <th>#</th>
                                <th>Trạm</th>
                                <th>Cổng/Point</th>
                                <th>Trạng thái</th>
                                <th>Start</th>
                                <th>End</th>
                                <th>Energy (kWh)</th>
                            </tr>
                        </thead>
                        <tbody>
                            @foreach (var s in b.Sessions.OrderBy(x => x.SessionId))
                            {
                                <tr>
                                    <td>@s.SessionId</td>
                                    <td>
                                        <div class="fw-semibold">@s.StationName</div>
                                        <div class="text-muted small">@s.StationLocation</div>
                                    </td>
                                    <td>
                                        <div>Port: <strong>@s.PortType</strong></div>
                                        <div class="text-muted small">PointId: @s.PointId</div>
                                    </td>
                                    <td>
                                        <span class="badge text-bg-@(s.Status == "success" ? "success" : s.Status == "ongoing" ? "primary" : "secondary")">
                                            @s.Status
                                        </span>
                                    </td>
                                    <td>@(s.StartTime?.ToLocalTime().ToString("dd/MM/yyyy HH:mm") ?? "-")</td>
                                    <td>@(s.EndTime?.ToLocalTime().ToString("dd/MM/yyyy HH:mm") ?? "-")</td>
                                    <td>@(s.EnergyConsumedKwh?.ToString("N3") ?? "-")</td>
                                </tr>
                            }
                        </tbody>
                    </table>
                </div>
            }
        </div>
    </div>
</div>
